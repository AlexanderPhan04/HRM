<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test API Production - HRM System</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        padding: 30px;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        text-align: center;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
      }

      .test-section {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .test-section h2 {
        color: #667eea;
        margin-bottom: 15px;
        font-size: 1.2em;
      }

      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: transform 0.2s, box-shadow 0.2s;
        margin: 5px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      .result {
        background: #fff;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        max-height: 400px;
        overflow-y: auto;
      }

      .result pre {
        margin: 0;
        white-space: pre-wrap;
        word-wrap: break-word;
        font-size: 13px;
        line-height: 1.5;
      }

      .success {
        border-color: #4caf50;
        background: #f1f8f4;
      }

      .error {
        border-color: #f44336;
        background: #fef1f0;
      }

      .info {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        border-left: 4px solid #2196f3;
      }

      .info strong {
        color: #1976d2;
      }

      .status {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 10px;
      }

      .status.ok {
        background: #4caf50;
        color: white;
      }

      .status.fail {
        background: #f44336;
        color: white;
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-left: 10px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .stat-card h3 {
        color: #667eea;
        font-size: 2em;
        margin-bottom: 10px;
      }

      .stat-card p {
        color: #666;
        font-size: 0.9em;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Test API Production</h1>
      <p class="subtitle">
        Ki·ªÉm tra API endpoints tr√™n hosting alexstudio.id.vn
      </p>

      <div class="info">
        <strong>üìã H∆∞·ªõng d·∫´n:</strong><br />
        1. Click v√†o c√°c n√∫t test b√™n d∆∞·ªõi ƒë·ªÉ ki·ªÉm tra API<br />
        2. Ki·ªÉm tra k·∫øt qu·∫£ trong ph·∫ßn "K·∫øt qu·∫£" (m√†u xanh = th√†nh c√¥ng, m√†u ƒë·ªè
        = l·ªói)<br />
        3. N·∫øu t·∫•t c·∫£ test ƒë·ªÅu PASS, API ƒë√£ ho·∫°t ƒë·ªông ƒë√∫ng!
      </div>

      <!-- Test 1: API Employees -->
      <div class="test-section">
        <h2>1Ô∏è‚É£ Test API Employees <span id="status1"></span></h2>
        <button onclick="testEmployees()">
          üßë‚Äçüíº Test GET /api.php/employees
        </button>
        <button onclick="testEmployeesAlt()">
          üßë‚Äçüíº Test GET /api/employees (URL Rewrite)
        </button>
        <div id="result1" class="result" style="display: none"></div>
      </div>

      <!-- Test 2: API Departments -->
      <div class="test-section">
        <h2>2Ô∏è‚É£ Test API Departments <span id="status2"></span></h2>
        <button onclick="testDepartments()">
          üè¢ Test GET /api.php/departments
        </button>
        <div id="result2" class="result" style="display: none"></div>
      </div>

      <!-- Test 3: API Positions -->
      <div class="test-section">
        <h2>3Ô∏è‚É£ Test API Positions <span id="status3"></span></h2>
        <button onclick="testPositions()">
          üíº Test GET /api.php/positions
        </button>
        <div id="result3" class="result" style="display: none"></div>
      </div>

      <!-- Test 4: API Auth -->
      <div class="test-section">
        <h2>4Ô∏è‚É£ Test API Auth <span id="status4"></span></h2>
        <button onclick="testAuthCheck()">
          üîê Test GET /api.php/auth/check
        </button>
        <div id="result4" class="result" style="display: none"></div>
      </div>

      <!-- Test 5: Run All Tests -->
      <div class="test-section">
        <h2>üöÄ Run All Tests</h2>
        <button
          onclick="runAllTests()"
          style="
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            font-size: 16px;
          "
        >
          ‚ñ∂Ô∏è Ch·∫°y T·∫•t C·∫£ Tests
        </button>
      </div>

      <!-- Statistics -->
      <div class="grid" id="stats" style="display: none">
        <div class="stat-card">
          <h3 id="totalEmployees">-</h3>
          <p>T·ªïng Nh√¢n Vi√™n</p>
        </div>
        <div class="stat-card">
          <h3 id="totalDepartments">-</h3>
          <p>Ph√≤ng Ban</p>
        </div>
        <div class="stat-card">
          <h3 id="totalPositions">-</h3>
          <p>V·ªã Tr√≠</p>
        </div>
        <div class="stat-card">
          <h3 id="testsPassed">-</h3>
          <p>Tests Passed</p>
        </div>
      </div>
    </div>

    <script>
      // Base URL - THAY ƒê·ªîI N·∫æU C·∫¶N
      const BASE_URL = "https://alexstudio.id.vn";
      // const BASE_URL = 'http://localhost'; // For local testing

      let testResults = {
        passed: 0,
        failed: 0,
        total: 0,
      };

      async function testAPI(url, resultId, statusId, testName) {
        const resultDiv = document.getElementById(resultId);
        const statusSpan = document.getElementById(statusId);

        resultDiv.style.display = "block";
        resultDiv.className = "result";
        resultDiv.innerHTML = '<div class="loading"></div> ƒêang g·ªçi API...';
        statusSpan.innerHTML = '<div class="loading"></div>';

        try {
          const startTime = performance.now();
          const response = await fetch(url);
          const endTime = performance.now();
          const data = await response.json();
          const responseTime = (endTime - startTime).toFixed(2);

          if (data.success) {
            resultDiv.className = "result success";
            statusSpan.innerHTML = '<span class="status ok">‚úì PASS</span>';
            testResults.passed++;

            let html = `<strong style="color: #4caf50;">‚úÖ SUCCESS (${responseTime}ms)</strong><br><br>`;
            html += `<strong>URL:</strong> ${url}<br>`;
            html += `<strong>Status:</strong> ${response.status} ${response.statusText}<br>`;
            html += `<strong>Message:</strong> ${data.message}<br>`;
            html += `<strong>Data Count:</strong> ${
              Array.isArray(data.data) ? data.data.length : data.data ? 1 : 0
            } items<br><br>`;
            html += `<strong>Response:</strong><br>`;
            html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;

            resultDiv.innerHTML = html;
            return data;
          } else {
            throw new Error(data.message || "API returned success: false");
          }
        } catch (error) {
          resultDiv.className = "result error";
          statusSpan.innerHTML = '<span class="status fail">‚úó FAIL</span>';
          testResults.failed++;

          let html = `<strong style="color: #f44336;">‚ùå ERROR</strong><br><br>`;
          html += `<strong>URL:</strong> ${url}<br>`;
          html += `<strong>Error:</strong> ${error.message}<br><br>`;
          html += `<strong>Possible causes:</strong><br>`;
          html += `‚Ä¢ API endpoint kh√¥ng t·ªìn t·∫°i<br>`;
          html += `‚Ä¢ Database ch∆∞a ƒë∆∞·ª£c import<br>`;
          html += `‚Ä¢ .htaccess ch∆∞a c·∫•u h√¨nh ƒë√∫ng<br>`;
          html += `‚Ä¢ CORS blocked (check browser console)<br>`;

          resultDiv.innerHTML = html;
          return null;
        } finally {
          testResults.total++;
        }
      }

      async function testEmployees() {
        const data = await testAPI(
          `${BASE_URL}/api.php/employees`,
          "result1",
          "status1",
          "Employees"
        );
        if (data && data.data) {
          document.getElementById("totalEmployees").textContent =
            data.data.length;
          document.getElementById("stats").style.display = "grid";
        }
      }

      async function testEmployeesAlt() {
        await testAPI(
          `${BASE_URL}/api/employees`,
          "result1",
          "status1",
          "Employees (URL Rewrite)"
        );
      }

      async function testDepartments() {
        const data = await testAPI(
          `${BASE_URL}/api.php/departments`,
          "result2",
          "status2",
          "Departments"
        );
        if (data && data.data) {
          document.getElementById("totalDepartments").textContent =
            data.data.length;
          document.getElementById("stats").style.display = "grid";
        }
      }

      async function testPositions() {
        const data = await testAPI(
          `${BASE_URL}/api.php/positions`,
          "result3",
          "status3",
          "Positions"
        );
        if (data && data.data) {
          document.getElementById("totalPositions").textContent =
            data.data.length;
          document.getElementById("stats").style.display = "grid";
        }
      }

      async function testAuthCheck() {
        await testAPI(
          `${BASE_URL}/api.php/auth/check`,
          "result4",
          "status4",
          "Auth Check"
        );
      }

      async function runAllTests() {
        testResults = { passed: 0, failed: 0, total: 0 };

        await testEmployees();
        await new Promise((resolve) => setTimeout(resolve, 500));

        await testDepartments();
        await new Promise((resolve) => setTimeout(resolve, 500));

        await testPositions();
        await new Promise((resolve) => setTimeout(resolve, 500));

        await testAuthCheck();

        // Update stats
        document.getElementById(
          "testsPassed"
        ).textContent = `${testResults.passed}/${testResults.total}`;
        document.getElementById("stats").style.display = "grid";

        // Show summary
        const passRate = (
          (testResults.passed / testResults.total) *
          100
        ).toFixed(0);
        const message =
          testResults.failed === 0
            ? `üéâ All tests passed! (${passRate}%)`
            : `‚ö†Ô∏è ${testResults.failed} test(s) failed (${passRate}% passed)`;

        alert(message);
      }

      // Auto-run on load (optional)
      // window.addEventListener('load', () => {
      //     setTimeout(runAllTests, 1000);
      // });
    </script>
  </body>
</html>
